<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>INFERNO | INTELLIGENCE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Outfit:wght@900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --orange: #FF4500; --glow: rgba(255, 69, 0, 0.6); }
        body { background: #050505; color: #EEE; font-family: 'Rajdhani', sans-serif; margin: 0; padding: 0; min-height: 100vh; position: relative; }
        .smoke-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.2; }
        .smoke { position: absolute; width: 200%; height: 200%; background: url('https://www.transparenttextures.com/patterns/asfalt-dark.png'); filter: blur(50px); animation: drift 60s linear infinite; }
        @keyframes drift { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .top-nav { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border-bottom: 1px solid var(--orange); padding: 15px; display: flex; justify-content: center; gap: 20px; position: sticky; top: 0; z-index: 100; }
        .nav-link { color: #888; text-decoration: none; font-family: 'Orbitron', sans-serif; font-size: 0.8em; transition: 0.3s; text-transform: uppercase; }
        .nav-link:hover { color: var(--orange); }
        .container { max-width: 1100px; margin: 40px auto; padding: 20px; }
        h1 { font-family: 'Outfit', sans-serif; font-weight: 900; color: var(--orange); text-align: center; letter-spacing: 4px; text-shadow: 0 0 20px var(--glow); font-size: 3.5em; text-transform: uppercase; margin-bottom: 40px; }
        .stats-table { width: 100%; border-collapse: collapse; background: rgba(20,20,20,0.8); backdrop-filter: blur(15px); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .stats-table th { background: #000; color: var(--orange); font-family: 'Orbitron', sans-serif; font-size: 0.75em; padding: 20px; text-align: left; border-bottom: 1px solid var(--orange); }
        .stats-table td { padding: 18px; border-bottom: 1px solid #222; font-size: 1.1em; }
        .name-link { color: var(--orange); font-weight: bold; text-decoration: none; }
        .status-tag { font-size: 0.8em; padding: 4px 8px; border-radius: 4px; margin-left: 10px; background: rgba(255,69,0,0.1); color: var(--orange); border: 1px solid var(--orange); }
    </style>
</head>
<body>
    <div class="smoke-container"><div class="smoke"></div></div>
    <nav class="top-nav">
        <a href="index.html" class="nav-link">Main Hub</a>
        <a href="war-room.html" class="nav-link">War Room</a>
    </nav>
    <div class="container">
        <h1>Intelligence</h1>
        <table class="stats-table" id="memberTable">
            <thead>
                <tr>
                    <th>Member</th>
                    <th>Last Action</th>
                    <th>Role</th>
                    <th>Battle Stats</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="4" style="text-align:center;">Connecting to Inferno Brain...</td></tr>
            </tbody>
        </table>
    </div>
    <script>
        const API_KEY = '8dOfVkNSWgShB27'; 
        const FAC_ID = '51373';
        // Using the direct CSV export link confirmed in your screenshot
        const BRAIN_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQnplVPLG6flEQ_DCD8ydwGyKlZh2xr6Gkej4RdcajQPJ1M2-CCKZvi_EDn8PKUhvHzNqe2gdgvNr2t/pub?gid=0&single=true&output=csv';

        async function loadData() {
            let sheetData = [];
            
            // Step 1: Try to get the Google Sheet data
            try {
                const sheetRes = await fetch(BRAIN_CSV);
                const sheetText = await sheetRes.text();
                sheetData = sheetText.split('\n').map(r => r.split(','));
            } catch (e) {
                console.warn("Brain CSV Connection Failed. Using Live Roster Only.");
            }

            // Step 2: Get the Live Roster from Torn
            try {
                const tornRes = await fetch(`https://api.torn.com/faction/${FAC_ID}?selections=basic&key=${API_KEY}`);
                const tornData = await tornRes.json();
                
                const tbody = document.querySelector('#memberTable tbody');
                tbody.innerHTML = '';
                
                if (!tornData.members) throw new Error("API Key Rejected");

                Object.values(tornData.members).sort((a,b) => a.name.localeCompare(b.name)).forEach(m => {
                    // Match ID in Column C (index 2) of the CSV
                    const statsEntry = sheetData.slice().reverse().find(r => r[2] && r[2].trim() == m.id);
                    const displayStats = statsEntry ? Number(statsEntry[3]).toLocaleString() : "Syncing...";
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><a href="member-detail.html?id=${m.id}" class="name-link">${m.name}</a></td>
                        <td>${m.last_action.relative}</td>
                        <td>${m.position}</td>
                        <td style="color:var(--orange); font-weight:bold;">${displayStats}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (e) { 
                document.querySelector('#memberTable tbody').innerHTML = '<tr><td colspan="4" style="text-align:center;">CRITICAL ERROR: CHECK TORN API KEY</td></tr>';
            }
        }
        loadData();
    </script>
</body>
</html>
