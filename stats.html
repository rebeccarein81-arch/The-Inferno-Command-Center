<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>INFERNO | INTELLIGENCE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: #EEE; font-family: 'Rajdhani', sans-serif; margin: 0; padding: 0; }
        .top-nav { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border-bottom: 1px solid #FF4500; padding: 15px; display: flex; justify-content: center; gap: 20px; }
        .nav-link { color: #888; text-decoration: none; font-family: 'Orbitron', sans-serif; font-size: 0.8em; transition: 0.3s; }
        .nav-link:hover { color: #FF4500; }
        
        .container { max-width: 1100px; margin: 40px auto; padding: 20px; }
        h1 { font-family: 'Orbitron', sans-serif; color: #FF4500; text-align: center; letter-spacing: 4px; }
        
        .stats-table { width: 100%; border-collapse: collapse; background: rgba(20,20,20,0.8); border-radius: 10px; overflow: hidden; }
        .stats-table th { background: #000; color: #FF4500; font-family: 'Orbitron', sans-serif; font-size: 0.75em; padding: 15px; text-align: left; }
        .stats-table td { padding: 15px; border-bottom: 1px solid #222; }
        .stats-table tr:hover { background: rgba(255,69,0,0.05); }
        
        .name-link { color: #FF8C00; font-weight: bold; text-decoration: none; }
        .name-link:hover { text-decoration: underline; color: #FF4500; }
        
        .search-bar { width: 100%; max-width: 400px; display: block; margin: 20px auto; padding: 10px; background: #111; border: 1px solid #FF4500; color: white; border-radius: 20px; text-align: center; }
    </style>
</head>
<body>
    <nav class="top-nav">
        <a href="index.html" class="nav-link">MAIN HUB</a>
        <a href="war-room.html" class="nav-link">WAR ROOM</a>
        <a href="tools.html" class="nav-link">UTILITIES</a>
    </nav>

    <div class="container">
        <h1>MEMBER INTELLIGENCE</h1>
        <input type="text" class="search-bar" id="memberSearch" placeholder="SEARCH ROSTER..." onkeyup="filterTable()">
        
        <table class="stats-table" id="memberTable">
            <thead>
                <tr>
                    <th>MEMBER</th>
                    <th>LAST ACTION</th>
                    <th>ROLE</th>
                    <th>TOTAL BATTLE STATS</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

    <script>
        const API_KEY = 'YOUR_API_KEY';
        const FAC_ID = 'YOUR_FACTION_ID';
        const BRAIN_CSV = 'YOUR_BRAIN_CSV_URL';

        async function loadData() {
            const [tornRes, sheetRes] = await Promise.all([
                fetch(`https://api.torn.com/faction/${FAC_ID}?selections=basic&key=${API_KEY}`),
                fetch(BRAIN_CSV)
            ]);

            const tornData = await tornRes.json();
            const sheetText = await sheetRes.text();
            const sheetRows = sheetText.split('\n').map(r => r.split(','));

            const tbody = document.querySelector('#memberTable tbody');
            tbody.innerHTML = '';

            Object.values(tornData.members).forEach(m => {
                // Find latest stat entry in Google Sheet by Member ID
                const statsEntry = sheetRows.reverse().find(r => r[2] == m.id) || [0,0,0,"0"];
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><a href="member-detail.html?id=${m.id}" class="name-link">${m.name}</a></td>
                    <td>${m.last_action.relative}</td>
                    <td>${m.position}</td>
                    <td style="color:#FF4500; font-weight:bold;">${Number(statsEntry[3]).toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterTable() {
            let filter = document.getElementById("memberSearch").value.toUpperCase();
            let rows = document.getElementById("memberTable").getElementsByTagName("tr");
            for (let i = 1; i < rows.length; i++) {
                let name = rows[i].getElementsByTagName("td")[0].innerText;
                rows[i].style.display = name.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            }
        }

        loadData();
    </script>
</body>
</html>
