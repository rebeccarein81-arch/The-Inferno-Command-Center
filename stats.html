<script>
    // Using your specific History tab link
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQnplVPLG6flEQ_DCD8ydwGyKlZh2xr6Gkej4RdcajQPJ1M2-CCKZvi_EDn8PKUhvHzNqe2gdgvNr2t/pub?gid=722061266&single=true&output=csv';

    async function loadSheet() {
        try {
            const response = await fetch(CSV_URL);
            const data = await response.text();
            
            // Basic check: if the sheet is empty, don't crash
            if (!data || data.length < 10) {
                throw new Error("Sheet is empty");
            }

            const rows = data.split('\n').map(row => row.split(','));
            const tbody = document.querySelector('#statsTable tbody');
            tbody.innerHTML = '';

            const latest = {};
            // Start from row 1 to skip headers
            for (let i = 1; i < rows.length; i++) {
                const r = rows[i];
                // Check if ID (Column C / Index 2) exists
                if (r && r[2] && r[2].trim() !== "") {
                    latest[r[2].trim()] = r; 
                }
            }

            const entries = Object.values(latest);
            if (entries.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No member history found in this tab.</td></tr>';
                return;
            }

            entries.forEach(entry => {
                const tr = document.createElement('tr');
                // Column A: Date, B: Name, C: ID, D: Stats
                tr.innerHTML = `
                    <td style="color:var(--orange); font-weight:bold;">${entry[1] || 'Unknown'}</td>
                    <td>${entry[0] || '---'}</td>
                    <td>Active</td>
                    <td style="color:var(--orange); font-weight:bold;">${entry[3] ? Number(entry[3]).toLocaleString() : '0'}</td>
                `;
                tbody.appendChild(tr);
            });

        } catch (e) {
            console.error("Manual Load Error:", e);
            document.querySelector('#statsTable tbody').innerHTML = `<tr><td colspan="4" style="text-align:center;">OFFLINE: Check if tab 722061266 has data.</td></tr>`;
        }
    }
    loadSheet();
</script>
