<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TICC | Intelligence Stats</title>
    <style>
        body
        <nav class="top-nav">
    <div class="nav-links">
        <a href="index.html" class="nav-item">MAIN HUB</a>
        <a href="stats.html" class="nav-item">INTELLIGENCE</a>
        <a href="war-room.html" class="nav-item">WAR ROOM</a>
        <a href="tools.html" class="nav-item">UTILITIES</a>
    </div>
</nav>

<style>
    .top-nav {
        background: #1A1A1A;
        border-bottom: 2px solid #FF4500;
        padding: 15px 0;
        margin-bottom: 30px;
        width: 100%;
    }
    .nav-links {
        display: flex;
        justify-content: center;
        gap: 15px;
    }
    .nav-item {
        text-decoration: none;
        color: #888;
        font-weight: bold;
        font-size: 0.85em;
        letter-spacing: 1px;
        padding: 8px 15px;
        border-radius: 4px;
        transition: 0.3s;
    }
    .nav-item:hover {
        color: #FF4500;
        background: #0D0D0D;
    }
    /* This makes the link look active if you're on that page */
    .nav-item:active {
        color: #FFF;
        border: 1px solid #FF4500;
    }
</style>
        
        { background-color: #0D0D0D; color: #E0E0E0; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        h1 { color: #FF4500; text-align: center; letter-spacing: 2px; }
        
        .nav-container { text-align: center; margin-bottom: 30px; }
        .nav-btn { text-decoration: none; color: #FF8C00; padding: 10px 20px; border: 1px solid #FF8C00; margin: 0 5px; border-radius: 4px; font-weight: bold; }
        .nav-btn:hover { background: #FF4500; color: white; }

        /* Search Bar Styling */
        .search-container { text-align: center; margin-bottom: 20px; }
        #memberSearch { 
            width: 80%; 
            max-width: 400px; 
            padding: 12px; 
            background: #1A1A1A; 
            border: 1px solid #FF4500; 
            color: white; 
            border-radius: 20px; 
            outline: none;
        }

        .stats-table { width: 100%; max-width: 900px; margin: 20px auto; border-collapse: collapse; background: #1A1A1A; border-radius: 8px; overflow: hidden; }
        .stats-table th, .stats-table td { padding: 15px; text-align: left; border-bottom: 1px solid #333; }
        .stats-table th { background-color: #000; color: #FF4500; font-size: 0.8em; }
        .clickable-name { color: #FF8C00; cursor: pointer; text-decoration: underline; }

        #history-section { max-width: 900px; margin: 40px auto; padding: 20px; border: 1px solid #FF4500; border-radius: 8px; display: none; }
        .gain-positive { color: #00FF00; }
    </style>
</head>
<body>

<div class="nav-container">
    <a href="index.html" class="nav-btn">Dashboard</a>
    <a href="war-room.html" class="nav-btn">War Room</a>
    <a href="stats.html" class="nav-btn" style="background:#FF4500; color:white;">Leaderboard</a>
</div>

<h1>MEMBER INTELLIGENCE</h1>

<div class="search-container">
    <input type="text" id="memberSearch" placeholder="Search for a member..." onkeyup="filterTable()">
</div>

<table class="stats-table" id="leaderboard">
    <thead>
        <tr>
            <th>Member</th>
            <th>Total Stats</th>
            <th>Xanax Taken</th>
            <th>7-Day Gain</th>
        </tr>
    </thead>
    <tbody>
        </tbody>
</table>

<div id="history-section">
    <h2 id="history-title" style="color:#FF4500;">Member History</h2>
    <div id="history-content">Select a name above to view historical logs.</div>
</div>

<script>
    const CSV_URL = 'PASTE_YOUR_CSV_LINK_HERE'; // Use your CSV Link here

    async function loadStats() {
        const response = await fetch(CSV_URL);
        const csvData = await response.text();
        const rows = csvData.split('\n').map(row => row.split(','));
        const data = rows.slice(1);

        const latestStats = {}; 
        data.forEach(row => {
            if(row[1]) latestStats[row[1]] = row; 
        });

        const tableBody = document.querySelector('#leaderboard tbody');
        tableBody.innerHTML = '';

        Object.values(latestStats).forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="clickable-name" onclick="showHistory('${row[1]}')">${row[1]}</td>
                <td>${Number(row[3]).toLocaleString()}</td>
                <td>${row[4]}</td>
                <td class="gain-positive">+${Number(row[5]).toLocaleString()}</td>
            `;
            tableBody.appendChild(tr);
        });

        window.fullFactionData = data;
    }

    // Filter Logic
    function filterTable() {
        let input = document.getElementById("memberSearch");
        let filter = input.value.toUpperCase();
        let table = document.getElementById("leaderboard");
        let tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            let td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                let txtValue = td.textContent || td.innerText;
                tr[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            }
        }
    }

    function showHistory(name) {
        const historySection = document.getElementById('history-section');
        const historyContent = document.getElementById('history-content');
        document.getElementById('history-title').innerText = `${name} - Progress History`;
        const memberLogs = window.fullFactionData.filter(row => row[1] === name);
        
        let html = '<table style="width:100%; margin-top:10px;"><tr><th>Date</th><th>Gain</th></tr>';
        memberLogs.reverse().forEach(log => {
            html += `<tr><td>${log[0]}</td><td class="gain-positive">+${log[5]}</td></tr>`;
        });
        html += '</table>';
        
        historyContent.innerHTML = html;
        historySection.style.display = 'block';
        historySection.scrollIntoView({ behavior: 'smooth' });
    }

    loadStats();
</script>

</body>
</html>
